(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{257:function(t,e,a){"use strict";a.r(e);var i=a(556);var n=a(364);for(var r in n)if(["default"].indexOf(r)<0)(function(t){a.d(e,t,(function(){return n[t]}))})(r);var s=a(493);var o=a(2);var l=Object(o["a"])(n["default"],i["a"],i["b"],false,null,"46958a72",null);e["default"]=l.exports},364:function(t,e,a){"use strict";a.r(e);var i=a(365);var n=a.n(i);for(var r in i)if(["default"].indexOf(r)<0)(function(t){a.d(e,t,(function(){return i[t]}))})(r);e["default"]=n.a},365:function(t,e,a){"use strict";var i=a(1);Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;var n=i(a(8));var r=i(a(5));var s=i(a(6));var o=i(a(17));var l=i(a(272));var u=a(9);var d=i(a(277));var c=i(a(281));function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);if(e)i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}));a.push.apply(a,i)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};if(e%2){p(Object(a),true).forEach((function(e){(0,o.default)(t,e,a[e])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))}else{p(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}}return t}var m={name:"cloud-manager-add",components:{Tips:l.default},mixins:[d.default],props:{id:{type:[Number,String],default:0},type:{type:String,default:"add",validator:function t(e){return["add","edit"].includes(e)}}},data:function t(){return{tipsList:[this.$t("云区域管理提示一")],formData:{bkCloudName:"",isp:"",apId:-1},rules:{bkCloudName:[{required:true,message:this.$t("必填项"),trigger:"blur"},{message:this.$t("不能超过32个字符"),trigger:"blur",validator:function t(e){return e.length<=32}},{message:this.$t("特殊字符限制"),trigger:"blur",validator:function t(e){var a=new RegExp("^[一-龥A-Za-z0-9-_]+$");return a.test(e)}}],isp:[{required:true,message:this.$t("必填项"),trigger:"blur"}]},loading:false,loadingSubmitBtn:false,apList:[],ispLoading:false,marginLeft:116,dialog:{show:false,bk_cloud_id:null}}},computed:f(f(f({},(0,u.mapGetters)(["ispList"])),(0,u.mapGetters)("cloud",["authority"])),{},{defaultAp:function t(){return this.apList.length===1?this.apList[0]:{id:-1,name:this.$t("自动选择接入点")}},submitBtnText:function t(){var e={add:this.$t("提交"),edit:this.$t("保存")};return e[this.type]},proxyOperateList:function t(){return this.authority.proxy_operate||[]}}),watch:{id:{handler:function t(){this.handleInit()},immediate:true}},mounted:function t(){this.marginLeft=this.initLabelWidth(this.$refs.form)},methods:f(f(f(f({},(0,u.mapMutations)(["setNavTitle"])),(0,u.mapActions)("cloud",["updateCloud","createCloud","getApList","getCloudDetail"])),(0,u.mapActions)(["getIspList"])),{},{handleInit:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){var a;return r.default.wrap((function t(i){while(1){switch(i.prev=i.next){case 0:e.initFormData();a=[];a.push(e.handleGetApList());if(!e.ispList.length){a.push(e.handleGetIspList())}if(e.id){e.loading=true;e.setNavTitle(e.$t("编辑云区域"));a.push(e.handleGetCloudDetail())}i.next=7;return Promise.all(a);case 7:e.loading=false;if(e.apList.length===1){e.formData.apId=e.apList[0].id}case 9:case"end":return i.stop()}}}),t)})))()},handleGetCloudDetail:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){var a;return r.default.wrap((function t(i){while(1){switch(i.prev=i.next){case 0:i.next=2;return e.getCloudDetail(e.id);case 2:a=i.sent;e.$set(e,"formData",(0,n.default)(e.formData,a));case 4:case"end":return i.stop()}}}),t)})))()},handleGetIspList:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){return r.default.wrap((function t(a){while(1){switch(a.prev=a.next){case 0:e.ispLoading=true;a.next=3;return e.getIspList();case 3:e.ispLoading=false;case 4:case"end":return a.stop()}}}),t)})))()},handleGetApList:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){return r.default.wrap((function t(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return e.getApList();case 2:e.apList=a.sent;case 3:case"end":return a.stop()}}}),t)})))()},initFormData:function t(){this.formData={bkCloudName:"",isp:"",apId:-1}},handleChangeAp:function t(e){this.formData.apId=e.id},handleSubmit:function t(){var e=this;this.$refs.form.validate().then((0,s.default)(r.default.mark((function t(){var a;return r.default.wrap((function t(i){while(1){switch(i.prev=i.next){case 0:e.loadingSubmitBtn=true;a=null;if(!(e.type==="add")){i.next=8;break}i.next=5;return e.handleCreateCloud();case 5:a=i.sent;i.next=11;break;case 8:i.next=10;return e.handleUpdateCloud();case 10:a=i.sent;case 11:e.loadingSubmitBtn=false;if(a){i.next=14;break}return i.abrupt("return");case 14:if(e.type==="add"){e.handleCreateSuccess(a)}else{e.handleEditSuccess()}case 15:case"end":return i.stop()}}}),t)}))))},handleEditSuccess:function t(){this.$bkMessage({theme:"success",message:this.$t("编辑成功")});this.handleCancel()},handleCreateSuccess:function t(e){this.dialog.show=true;this.dialog.bk_cloud_id=e.bk_cloud_id},handleCreateCloud:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){var a;return r.default.wrap((function t(i){while(1){switch(i.prev=i.next){case 0:i.next=2;return e.createCloud({bk_cloud_name:e.formData.bkCloudName,isp:e.formData.isp,ap_id:e.formData.apId});case 2:a=i.sent;return i.abrupt("return",a);case 4:case"end":return i.stop()}}}),t)})))()},handleUpdateCloud:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){var a;return r.default.wrap((function t(i){while(1){switch(i.prev=i.next){case 0:i.next=2;return e.updateCloud({pk:e.id,params:{bk_cloud_name:e.formData.bkCloudName,isp:e.formData.isp,ap_id:e.formData.apId}});case 2:a=i.sent;return i.abrupt("return",a);case 4:case"end":return i.stop()}}}),t)})))()},handleCancel:function t(){this.$router.push({name:"cloudManager"})},handleDefaultApChange:function t(e){if(!e&&!this.formData.apId&&this.apList.length){this.formData.apId=this.apList[0].id}},setupProxy:function t(){this.dialog.show=false;this.$router.replace({name:"setupCloudManager",params:{id:this.dialog.bk_cloud_id||this.id,type:"create"}})}})};e.default=m},366:function(t,e,a){},493:function(t,e,a){"use strict";var i=a(366);var n=a.n(i);var r=n.a},556:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));a.d(e,"b",(function(){return n}));var i=function(){var t=this;var e=t.$createElement;var a=t._self._c||e;return a("article",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading},expression:"{ isLoading: loading }"}],staticClass:"add-cloud"},[a("section",{staticClass:"add-cloud-tips mb20"},[a("tips",{attrs:{list:t.tipsList}})],1),t._v(" "),a("section",{staticClass:"add-cloud-form"},[a("bk-form",{ref:"form",attrs:{"label-width":116,model:t.formData,rules:t.rules}},[a("bk-form-item",{attrs:{"error-display-type":"normal",label:t.$t("云区域名称"),property:"bkCloudName",required:""}},[a("bk-input",{staticClass:"content-basic",attrs:{placeholder:t.$t("请输入")},model:{value:t.formData.bkCloudName,callback:function(e){t.$set(t.formData,"bkCloudName",e)},expression:"formData.bkCloudName"}})],1),t._v(" "),a("bk-form-item",{attrs:{"error-display-type":"normal",label:t.$t("云服务商"),property:"isp",required:""}},[a("bk-select",{staticClass:"content-basic",attrs:{placeholder:t.$t("请选择"),clearable:false,loading:t.ispLoading},model:{value:t.formData.isp,callback:function(e){t.$set(t.formData,"isp",e)},expression:"formData.isp"}},t._l(t.ispList,(function(e){return a("bk-option",{key:e.isp,attrs:{id:e.isp,name:e.isp_name}},[e.isp_icon?a("img",{staticClass:"option-icon mr5",attrs:{src:"data:image/svg+xml;base64,"+e.isp_icon}}):t._e(),t._v(" "),a("span",[t._v(t._s(e.isp_name))])])})),1)],1),t._v(" "),a("bk-form-item",{attrs:{"error-display-type":"normal","ext-cls":t.apList.length>1?"content-access":"",label:t.$t("选择接入点"),required:""}},[t.apList.length>1?a("div",[a("div",{staticClass:"access-content"},[a("bk-checkbox",{attrs:{"true-value":-1},on:{change:t.handleDefaultApChange},model:{value:t.formData.apId,callback:function(e){t.$set(t.formData,"apId",e)},expression:"formData.apId"}},[t._v("\n              "+t._s(t.$t("自动选择接入点"))+"\n            ")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.formData.apId!==-1,expression:"formData.apId !== -1"}],staticClass:"bk-button-group mt10"},t._l(t.apList,(function(e){return a("bk-button",{key:e.id,class:{"is-selected":e.id===t.formData.apId},on:{click:function(a){return t.handleChangeAp(e)}}},[t._v("\n              "+t._s(e.name)+"\n            ")])})),1)]):a("div",[a("bk-input",{staticClass:"content-basic",attrs:{placeholder:t.$t("请输入"),value:t.defaultAp.name,disabled:""}})],1)])],1)],1),t._v(" "),a("section",{staticClass:"add-cloud-footer"},[a("bk-button",{style:{marginLeft:t.marginLeft+"px"},attrs:{theme:"primary","ext-cls":"nodeman-primary-btn",loading:t.loadingSubmitBtn},on:{click:t.handleSubmit}},[t._v("\n      "+t._s(t.submitBtnText)+"\n    ")]),t._v(" "),a("bk-button",{staticClass:"nodeman-cancel-btn ml5",on:{click:t.handleCancel}},[t._v(t._s(t.$t("取消")))])],1),t._v(" "),a("bk-dialog",{attrs:{theme:"primary","mask-close":false,"show-footer":false},model:{value:t.dialog.show,callback:function(e){t.$set(t.dialog,"show",e)},expression:"dialog.show"}},[a("div",{staticClass:"bk-info-box"},[a("div",{staticClass:"bk-dialog-type-body"},[a("i",{staticClass:"bk-icon bk-dialog-mark bk-dialog-success icon-check-1"})]),t._v(" "),a("div",{staticClass:"bk-dialog-type-header has-sub-header"},[a("div",{staticClass:"header"},[t._v(t._s(t.$t("创建云区域成功")))])]),t._v(" "),a("div",{staticClass:"bk-dialog-type-sub-header"},[a("div",{staticClass:"header"},[a("a",{staticClass:"info-dialog-btn",on:{click:t.handleCancel}},[t._v(t._s(t.$t("返回列表")))]),t._v(" "),a("auth-component",{staticClass:"ml30",attrs:{tag:"div",auth:{permission:!!t.proxyOperateList.length,apply_info:[{action:"proxy_operate"}]}},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.disabled;return[a("a",{staticClass:"info-dialog-btn",attrs:{disabled:i},on:{click:t.setupProxy}},[t._v(t._s(t.$t("安装Proxy")))])]}}])})],1)])])])],1)};var n=[]}}]);