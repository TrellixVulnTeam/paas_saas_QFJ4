(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{254:function(e,t,i){"use strict";i.r(t);var n=i(559);var a=i(352);for(var r in a)if(["default"].indexOf(r)<0)(function(e){i.d(t,e,(function(){return a[e]}))})(r);var s=i(490);var o=i(2);var l=Object(o["a"])(a["default"],n["a"],n["b"],false,null,"1a55375d",null);t["default"]=l.exports},352:function(e,t,i){"use strict";i.r(t);var n=i(353);var a=i.n(n);for(var r in n)if(["default"].indexOf(r)<0)(function(e){i.d(t,e,(function(){return n[e]}))})(r);t["default"]=a.a},353:function(e,t,i){"use strict";var n=i(1);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var a=n(i(8));var r=n(i(5));var s=n(i(6));var o=n(i(17));var l=n(i(305));var u=n(i(318));var d=n(i(338));var c=n(i(272));var p=n(i(342));var f=n(i(346));var h=n(i(347));var _=n(i(487));var b=i(445);var g=i(489);var v=i(280);var m=i(10);var w=i(9);function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);if(t)n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));i.push.apply(i,n)}return i}function k(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};if(t%2){y(Object(i),true).forEach((function(t){(0,o.default)(e,t,i[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(i))}else{y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}}return e}var x={name:"agent-import",components:{RightPanel:l.default,SetupTable:u.default,InstallMethod:d.default,ParserExcel:_.default,FilterDialog:h.default,Tips:c.default,FilterIpTips:p.default},mixins:[f.default],props:{tableData:{type:Array,default:function e(){return[]}},isSelectedAllPages:{type:Boolean,default:false},condition:{type:Object,default:function e(){return{}}},type:{type:String,default:"INSTALL_AGENT",validator:function e(t){return["INSTALL_AGENT","REINSTALL_AGENT","RELOAD_AGENT","UPGRADE_AGENT","UNINSTALL_AGENT"].includes(t)}}},data:function e(){return{isManual:false,importTips:this.$t("excel导入提示"),showRightPanel:false,tableDataBackup:[],setupInfo:{header:b.tableConfig,data:[]},listenResize:null,isScroll:false,importDialog:false,isUploading:false,loadingSetupBtn:false,showSetupBtn:false,height:0,loading:false,editTableHead:{editConfig:[],editManualConfig:[]}}},computed:k(k({},(0,w.mapGetters)("agent",["apUrl","apList","cloudList"])),{},{disabledImport:function e(){return!this.setupInfo.data.length},setupNum:function e(){return this.setupInfo.data.length},virtualScroll:function e(){return this.setupNum*44>=this.height-this.surplusHeight},scrollHeight:function e(){return this.virtualScroll&&this.height?"".concat(this.height-this.surplusHeight,"px"):"auto"},surplusHeight:function e(){var t=135;t+=37;if(this.filterList.length&&this.showFilterTips){t+=52}if(this.showSetupBtn&&!this.isEdit){t+=52}return t},isEdit:function e(){return!!(this.tableData&&this.tableData.length)||this.isSelectedAllPages},isNotAutoSelect:function e(){return this.apList.length===1},minItems:function e(){if(this.isEdit)return 1;return 0},setupBtnText:function e(){var t={INSTALL_AGENT:this.$t("安装"),REINSTALL_AGENT:this.$t("重装"),RELOAD_AGENT:this.$t("重载配置"),UPGRADE_AGENT:this.$t("升级"),UNINSTALL_AGENT:this.$t("卸载")};return t[this.type]},extraParams:function e(){if(this.isEdit)return["bk_host_id","is_manual"];return["outer_ip","is_manual"]},hostType:function e(){var t=this.setupInfo.data.every((function(e){return e&&e.bk_cloud_id===window.PROJECT_CONFIG.DEFAULT_CLOUD}));var i=this.setupInfo.data.every((function(e){return e&&e.bk_cloud_id!==window.PROJECT_CONFIG.DEFAULT_CLOUD}));if(t){return"Agent"}if(i){return"Pagent"}return"mixed"},hostList:function e(){var t=this;var i=this.setupInfo.data.map((function(e){if(!e){return{}}var i=t.cloudList.find((function(t){return e.bk_cloud_id===t.bk_cloud_id}));return{bk_cloud_id:e.bk_cloud_id,bk_cloud_name:i?i.bk_cloud_name:"",inner_ip:e.inner_ip,ap_id:e.ap_id}}));i.sort((function(e,t){return e.bk_cloud_id-t.bk_cloud_id}));return i}}),created:function e(){switch(this.type){case"REINSTALL_AGENT":this.setNavTitle(this.$t("重装Agent"));break;case"RELOAD_AGENT":this.setNavTitle(this.$t("重载Agent配置"));break}this.resetTableHead()},mounted:function e(){var t=this;this.handleInit();this.listenResize=(0,m.debounce)(300,(function(e){return t.handleResize(e)}));(0,v.addListener)(this.$el,this.listenResize);this.height=this.$refs.setupContent.clientHeight},beforeDestroy:function e(){this.setApUrl({id:""});(0,v.removeListener)(this.$el,this.listenResize)},methods:k(k(k(k({},(0,w.mapMutations)(["setNavTitle"])),(0,w.mapMutations)("agent",["setApList"])),(0,w.mapActions)("agent",["getApList","getCloudList","installAgentJob","getHostList","setApUrl"])),{},{handleInit:function e(){var t=this;return(0,s.default)(r.default.mark((function e(){var i;return r.default.wrap((function e(n){while(1){switch(n.prev=n.next){case 0:t.loading=true;i=[];i.push(t.getCloudList(t.isEdit?{}:{RUN_VER:window.PROJECT_CONFIG.RUN_VER}));i.push(t.getApList(!t.isEdit).then((function(e){t.setApUrl({id:-1});return e})));n.next=6;return Promise.all(i);case 6:if(!t.isEdit){n.next=9;break}n.next=9;return t.handleInitEditData();case 9:t.$nextTick().then((function(){t.loading=false}));case 10:case"end":return n.stop()}}}),e)})))()},handleInitEditData:function e(){var t=this;return(0,s.default)(r.default.mark((function e(){var i,n;return r.default.wrap((function e(r){while(1){switch(r.prev=r.next){case 0:t.showSetupBtn=true;i=[];n=t.isNotAutoSelect?t.apList[0].id:"";if(!t.isSelectedAllPages){r.next=10;break}r.next=6;return t.getHostList(t.condition);case 6:i=r.sent;i=i.list.map((function(e){var i=t.isNotAutoSelect&&e.ap_id===-1?{ap_id:n}:{};return(0,a.default)({},e,e.identity_info,i)}));r.next=11;break;case 10:i=JSON.parse(JSON.stringify(t.isNotAutoSelect?t.tableData.map((function(e){return e.ap_id===-1?(0,a.default)(e,{ap_id:n}):e})):t.tableData));case 11:t.tableDataBackup=i;t.setupInfo.data=(0,m.deepClone)(i);t.isManual=t.setupInfo.data.some((function(e){return e.is_manual}));t.setupInfo.header=t.isManual?t.editTableHead.editManualConfig:t.editTableHead.editConfig;t.$refs.setupTable.handleInit();t.$refs.setupTable.handleScroll();case 17:case"end":return r.stop()}}}),e)})))()},handleResize:function e(){this.isScroll=this.$el.scrollHeight+60>this.$root.$el.clientHeight-52},handleShowDialog:function e(){this.importDialog=true},handleImport:function e(){this.$refs.setupTable.handleInit();this.$refs.setupTable.handleScroll();this.showSetupBtn=true},handleSetup:function e(){var t=this;return(0,s.default)(r.default.mark((function e(){var i,n,s,o,l,u,d;return r.default.wrap((function e(r){while(1){switch(r.prev=r.next){case 0:i=t.$refs.setupTable.validate();if(!i){r.next=14;break}t.loadingSetupBtn=true;n=t.$refs.setupTable.getData();n.forEach((function(e){if((0,m.isEmpty)(e.login_ip)){delete e.login_ip}if((0,m.isEmpty)(e.bt_speed_limit)){delete e.bt_speed_limit}else{e.bt_speed_limit=Number(e.bt_speed_limit)}e.peer_exchange_switch_for_agent+=0}));if(t.type==="INSTALL_AGENT"){s={is_manual:t.isManual};n=n.map((function(e){return(0,a.default)(e,s)}))}o={job_type:t.type,hosts:n};r.next=9;return t.installAgentJob({params:o,config:{needRes:true,globalError:false}});case 9:l=r.sent;t.loadingSetupBtn=false;if(l){r.next=13;break}return r.abrupt("return");case 13:if(l.result||l.code===3801018){t.handleFilterIp(l.data,t.type==="INSTALL_AGENT")}else if(l.code===3801013){u=t.$refs.setupTable.getTableData().map((function(e){var t=l.data.ip_filter.find((function(t){var i="".concat(t.ip).concat(t.bk_cloud_id);var n="".concat(e.inner_ip).concat(e.bk_cloud_id);return i===n}));if(t){e.proxyStatus=t.exception}return e}));t.$refs.setupTable.handleUpdateData(u);t.$refs.setupTable.validate()}else{d=l.message?l.message:t.$t("请求出错");t.$bkMessage({message:d,delay:3e3,theme:"error"})}case 14:case"end":return r.stop()}}}),e)})))()},handleLastStep:function e(){this.showFilterTips=false;this.filterList.splice(0,this.filterList.length);this.setupInfo.data.splice(0,this.setupInfo.data.length);this.tableDataBackup.splice(0,this.tableDataBackup.length);this.showSetupBtn=false;this.$refs.setupTable.handleInit();this.$refs.setupTable.handleScroll()},handleCancel:function e(){this.$router.push({name:"agentStatus"})},handleUploading:function e(t,i){this.isUploading=t;if(!this.isUploading&&i&&i.length){this.tableDataBackup=i;this.setupInfo.data=(0,m.deepClone)(i)}},handleItemDelete:function e(t){this.setupInfo.data.splice(t,1);this.tableDataBackup.splice(t,1);if(!this.setupInfo.data.length){this.handleLastStep()}},installMethodHandle:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.isManual=i;var n=(0,m.deepClone)(this.$refs.setupTable.getData());var a=(0,m.deepClone)(this.apList);if(this.isManual){this.setupInfo.header=b.tableManualConfig;a=a.filter((function(e){return e.id!==-1}));var r=this.isNotAutoSelect?this.apList[0]:this.apList.find((function(e){return e.is_default}));var s=r?r.id:"";n.forEach((function(e){if(e.ap_id===-1){e.ap_id=s}}))}else{if(!a.find((function(e){return e.id===-1}))){a.unshift({id:-1,name:this.$t("自动选择")})}this.setupInfo.header=b.tableConfig;n.forEach((function(e,i){e.ap_id=t.tableDataBackup[i].ap_id}))}this.setApList(a);this.setupInfo.data=n;this.$refs.setupTable.handleInit();this.$refs.setupTable.handleScroll()},handleShowSetting:function e(){this.$refs.setupTable.handleToggleSetting(true)},resetTableHead:function e(){if(this.type==="RELOAD_AGENT"){var t=["inner_ip","bk_biz_id","bk_cloud_id","ap_id","os_type","peer_exchange_switch_for_agent","bt_speed_limit"];this.editTableHead.editConfig=g.editConfig.filter((function(e){return t.includes(e.prop)||e.type==="operate"})).map((function(e){return(0,a.default)(k({},e),{show:true})}));this.editTableHead.editManualConfig=g.editManualConfig.map((function(e){return(0,a.default)(k({},e),{show:true})}))}else{this.editTableHead.editConfig=g.editConfig;this.editTableHead.editManualConfig=g.editManualConfig}},handleShowPanel:function e(){this.setupInfo.data=(0,m.deepClone)(this.$refs.setupTable.getData());this.showRightPanel=true}})};t.default=x},354:function(e,t,i){"use strict";i.r(t);var n=i(355);var a=i.n(n);for(var r in n)if(["default"].indexOf(r)<0)(function(e){i.d(t,e,(function(){return n[e]}))})(r);t["default"]=a.a},355:function(e,t,i){"use strict";var n=i(1);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var a=n(i(5));var r=n(i(274));var s=n(i(6));var o=n(i(17));var l=i(445);var u=i(273);var d=i(9);var c=i(10);function p(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);if(t)n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));i.push.apply(i,n)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};if(t%2){p(Object(i),true).forEach((function(t){(0,o.default)(e,t,i[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(i))}else{p(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}}return e}var h={name:"parser-excel",filters:{fileSizeFormat:function e(t){var i=1024;var n=t/Math.pow(i,2);return"".concat(n.toFixed(2)," M")}},props:{accept:{type:String,default:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}},data:function e(){return{status:"import",maxFileSize:20,file:{},data:{},showAbort:false,optional:["auth_type","bk_biz_id","bk_cloud_id","ap_id","login_ip","peer_exchange_switch_for_agent","bt_speed_limit"],isHover:false,extraParams:[{prop:"outer_ip",label:"".concat(this.$t("外网IP")).concat(this.$t("可选")),regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$"}]}},computed:f(f(f({},(0,d.mapGetters)(["bkBizList"])),(0,d.mapGetters)("agent",["apList","cloudList"])),{},{isLoading:function e(){return!["success","error"].includes(this.file.status)&&this.status==="parsing"}}),watch:{value:function e(t){if(!t){this.file={};this.status="import";this.$refs.upload.value=""}}},methods:{validateFile:function e(t){var i={success:true,message:""};if(t.size>this.maxFileSize*1024*1024){i.success=false;i.message=this.$t("文件不能超过",{size:this.maxFileSize})}else if(t.type!==this.accept){i.success=false;i.message=this.$t("只支持“xlsx”格式的文件")}if(!i.success){this.$refs.upload.value="";this.$bkMessage({theme:"error",message:i.message})}return i.success},handleFileChange:function e(t){var i=this;return(0,s.default)(a.default.mark((function e(){var n,s,o,l;return a.default.wrap((function e(a){while(1){switch(a.prev=a.next){case 0:n=t.target.files;if(n.length){a.next=3;break}return a.abrupt("return");case 3:s=(0,r.default)(n,1),o=s[0];l=i.validateFile(o);if(l){a.next=7;break}return a.abrupt("return");case 7:i.file=i.getFileInfo(o);a.next=10;return i.parseFile(o);case 10:case"end":return a.stop()}}}),e)})))()},parseFile:function e(t){var n=this;return(0,s.default)(a.default.mark((function e(){var r;return a.default.wrap((function e(a){while(1){switch(a.prev=a.next){case 0:n.$emit("uploading",true,[]);n.status="parsing";r=new FileReader;r.onload=function(e){try{var t=e.target.result;Promise.all([i.e(1),i.e(2)]).then(i.t.bind(null,448,7)).then((function(e){var i=e.read(t,{type:"binary"});var a=Object.keys(i.Sheets);var r=e.utils.sheet_to_json(i.Sheets[a[0]]);var s=n.validateExcelData(r);if(s.status==="ok"){var o=n.getImportData(r);n.$emit("uploading",false,o);setTimeout((function(){n.file.status="success"}),200)}else{n.$emit("uploading",false);setTimeout((function(){n.file.msg=s.msg;n.file.status="error"}),200)}}))}catch(e){n.$emit("uploading",false);setTimeout((function(){n.file.msg=n.$t("解析文件失败");n.file.status="error"}),200)}};r.onprogress=function(e){n.file.progress=parseInt(e.loaded/e.total*100,10)};r.readAsBinaryString(t);case 6:case"end":return a.stop()}}}),e)})))()},validateExcelData:function e(t){var i=this;var n={status:"ok",msg:""};if(t.length!==0){var a=Object.keys(t[0]);var r=l.tableConfig.filter((function(e){return!i.optional.includes(e.prop)})).map((function(e){return e.label}));var s=r.find((function(e){return!a.includes(i.$t(e))}));if(s){n.status="error";n.msg=this.$t("列缺失",{label:s})}else{n.status="ok";n.msg=""}}else{n.status="error";n.msg=this.$t("Excel数据为空")}return n},getImportData:function e(t){var i=this;var n=[];var a=[this.$t("登录IP"),this.$t("BT传输加速"),this.$t("传输限速")];try{t.forEach((function(e){var t={};var r=false;l.tableConfig.forEach((function(n){var s=i.$t(n.label);if(s===i.$t("业务")){var o=i.bkBizList.find((function(t){return t.bk_biz_name===e["".concat(s).concat(i.$t("可选"))]}));t[n.prop]=o&&!(0,c.isEmpty)(o.bk_biz_id)?o.bk_biz_id:""}else if(s===i.$t("云区域")){var l=i.cloudList.find((function(t){return t.bk_cloud_name===e["".concat(s).concat(i.$t("可选"))]}));t[n.prop]=l&&!(0,c.isEmpty)(l.bk_cloud_id)?l.bk_cloud_id:""}else if(s===i.$t("接入点")){var d=i.apList.find((function(t){return t.name===e["".concat(s).concat(i.$t("可选"))]}));t[n.prop]=d&&!(0,c.isEmpty)(d.id)?d.id:-1}else if(a.includes(s)){t[n.prop]=!(0,c.isEmpty)(e["".concat(s).concat(i.$t("可选"))])?e["".concat(s).concat(i.$t("可选"))]:""}else if(s===i.$t("认证方式")){var p="";if(!(0,c.isEmpty)(e[s])){var f=u.authentication.find((function(t){return t.name===e[s]}));if(f){p=f.id;if(p!=="PASSWORD"){t.prove=f.default||"";r=true}}}t[n.prop]=p}else if(n.prop){if(!r||n.prop!=="prove"){t[n.prop]=!(0,c.isEmpty)(e[s])?e[s]:""}}}));i.extraParams.forEach((function(i){var n=e[i.label];var a=!i.regx||new RegExp(i.regx).test(n);if(a){t[i.prop]=n}}));t.is_manual=false;if(Object.keys(t).length){n.push(t)}}))}catch(e){n=[]}return n},getFileInfo:function e(t){return{name:t.name,size:t.size,origin:t,progress:0,status:"loading",msg:""}},handleRetry:function e(){this.file.status="loading";this.parseFile(this.file.origin)},handleDelete:function e(){this.file={};this.$refs.upload.value="";this.status="import"},handleAbortParse:function e(){this.handleDelete()},handleMouseEnter:function e(){this.isHover=true;this.showAbort=true},handleMouseLeave:function e(){this.isHover=false;this.showAbort=false},handleDownload:function e(){var t="".concat(window.PROJECT_CONFIG.STATIC_URL,"download/bk_nodeman_info_").concat(window.language,".xlsx");var i=document.createElement("a");i.setAttribute("href",t);i.setAttribute("download","bk_nodeman_info.xlsx");i.style.display="none";document.body.appendChild(i);i.click();document.body.removeChild(i)}}};t.default=h},356:function(e,t,i){},357:function(e,t,i){},445:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.tableManualConfig=t.tableConfig=void 0;var n=i(273);var a=[{label:"IP地址",prop:"inner_ip",type:"text",required:true,noRequiredMark:false,union:"bk_cloud_id",unique:true,errTag:true,rules:[{regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",content:window.i18n.t("IP不符合规范")},{trigger:"blur",content:window.i18n.t("冲突校验",{prop:"IP"}),validator:function e(t,i){if(!t)return true;var n=this.table.data.find((function(e){return e.id===i}));if(!n)return;return this.handleValidateUnique(n,{prop:"inner_ip"})}}]},{label:"业务",prop:"bk_biz_id",type:"biz",batch:true,required:true,noRequiredMark:false,multiple:false,placeholder:window.i18n.t("选择业务")},{label:"云区域",prop:"bk_cloud_id",type:"select",batch:true,required:true,noRequiredMark:false,popoverMinWidth:160,placeholder:window.i18n.t("请选择"),permission:true,getOptions:function e(){return this.cloudList.map((function(e){return{name:e.bk_cloud_name,id:e.bk_cloud_id,permission:e.view,permissionType:"cloud_view"}}))},handleValueChange:function e(t){if(t.proxyStatus){t.proxyStatus=""}var i=this.cloudList.find((function(e){return e.bk_cloud_id===t.bk_cloud_id}));if(i&&i.bk_cloud_id!==window.PROJECT_CONFIG.DEFAULT_CLOUD){t.ap_id=i.ap_id}else{t.ap_id=-1}},getProxyStatus:function e(t){return t.proxyStatus}},{label:"接入点",prop:"ap_id",type:"select",batch:true,required:true,noRequiredMark:false,default:-1,options:[],popoverMinWidth:160,getOptions:function e(){return this.apList},getReadonly:function e(t){return t.bk_cloud_id&&t.bk_cloud_id!==window.PROJECT_CONFIG.DEFAULT_CLOUD}},{label:"操作系统",prop:"os_type",type:"select",batch:true,required:true,noRequiredMark:false,placeholder:window.i18n.t("请选择"),options:[{id:"WINDOWS",name:"Windows"},{id:"LINUX",name:"Linux"},{id:"AIX",name:"AIX"}],handleValueChange:function e(t){if(t.os_type==="WINDOWS"){t.port=445;t.account="Administrator"}else{t.port=n.defaultPort;t.account="root"}}},{label:"登录端口",prop:"port",type:"text",required:true,noRequiredMark:false,batch:true,default:n.defaultPort,rules:[{regx:"^([0-9]|[1-9]\\d{1,3}|[1-5]\\d{4}|6[0-4]\\d{4}|65[0-4]\\d{2}|655[0-2]\\d|6553[0-5])$",content:window.i18n.t("端口范围",{range:"0-65535"})}],getReadonly:function e(t){return t&&t.os_type==="WINDOWS"}},{label:"登录账号",prop:"account",type:"text",required:true,noRequiredMark:false,batch:true,default:"root"},{label:"认证方式",prop:"auth_type",type:"select",required:true,noRequiredMark:false,batch:true,subTitle:window.i18n.t("密钥方式仅对Linux/AIX系统生效"),default:"PASSWORD",getOptions:function e(t){return t.os_type==="WINDOWS"?n.authentication.filter((function(e){return e.id!=="KEY"})):n.authentication},handleValueChange:function e(t){var i=n.authentication.find((function(e){return e.id===t.auth_type}))||{};t.prove=i.default||""}},{label:"密码密钥",required:true,noRequiredMark:false,prop:"prove",type:"password",batch:true,subTitle:window.i18n.t("仅对密码认证生效"),placeholder:window.i18n.t("请输入"),getReadonly:function e(t){return t.auth_type&&t.auth_type==="TJJ_PASSWORD"},getCurrentType:function e(t){var i=n.authentication.find((function(e){return e.id===t.auth_type}))||{};return i.type||"text"}},{label:"登录IP",prop:"login_ip",type:"text",required:false,noRequiredMark:false,placeholder:window.i18n.t("请输入"),unique:true,errTag:true,rules:[{regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",content:window.i18n.t("IP不符合规范")},{trigger:"blur",content:window.i18n.t("冲突校验",{prop:"IP"}),validator:function e(t,i){if(!t)return true;var n=this.table.data.find((function(e){return e.id===i}));if(!n)return;return this.handleValidateUnique(n,{prop:"inner_ip"})}}]},{label:"BT传输加速",prop:"peer_exchange_switch_for_agent",type:"switcher",default:true,batch:true,required:false,noRequiredMark:false,width:115},{label:"传输限速",prop:"bt_speed_limit",type:"text",batch:true,required:false,noRequiredMark:false,appendSlot:"MB/s",iconOffset:40,width:115,placeholder:window.i18n.t("请输入"),rules:[{regx:"^[1-9]\\d*$",content:window.i18n.t("整数最小值校验提示",{min:1})}]},{label:"",prop:"",type:"operate",width:42}];t.tableConfig=a;var r=[{label:"IP地址",prop:"inner_ip",type:"text",required:true,noRequiredMark:false,union:"bk_cloud_id",unique:true,errTag:true,rules:[{regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",content:window.i18n.t("IP不符合规范")},{trigger:"blur",content:window.i18n.t("冲突校验",{prop:"IP"}),validator:function e(t,i){if(!t)return true;var n=this.table.data.find((function(e){return e.id===i}));if(!n)return;return this.handleValidateUnique(n,{prop:"inner_ip"})}}]},{label:"业务",prop:"bk_biz_id",type:"biz",batch:true,required:true,noRequiredMark:false,multiple:false},{label:"云区域",prop:"bk_cloud_id",type:"select",batch:true,required:true,noRequiredMark:false,popoverMinWidth:160,placeholder:window.i18n.t("请选择"),permission:true,getOptions:function e(){return this.cloudList.map((function(e){return{name:e.bk_cloud_name,id:e.bk_cloud_id,permission:e.view,permissionType:"cloud_view"}}))},handleValueChange:function e(t){if(t.proxyStatus){t.proxyStatus=""}var i=this.cloudList.find((function(e){return e.bk_cloud_id===t.bk_cloud_id}));var n=-1;if(this.isManual){var a=this.apList.find((function(e){return e.is_default}));n=a?a.id:""}if(i&&i.bk_cloud_id!==window.PROJECT_CONFIG.DEFAULT_CLOUD){t.ap_id=i.ap_id}else{t.ap_id=n}},getProxyStatus:function e(t){return t.proxyStatus}},{label:"接入点",prop:"ap_id",type:"select",batch:true,required:true,noRequiredMark:false,default:-1,options:[],popoverMinWidth:160,getOptions:function e(){return this.apList},getReadonly:function e(t){return this.isManual?false:t.bk_cloud_id&&t.bk_cloud_id!==window.PROJECT_CONFIG.DEFAULT_CLOUD}},{label:"操作系统",prop:"os_type",type:"select",batch:true,required:true,noRequiredMark:false,placeholder:window.i18n.t("请选择"),options:[{id:"WINDOWS",name:"Windows"},{id:"LINUX",name:"Linux"},{id:"AIX",name:"AIX"}],handleValueChange:function e(t){if(t.os_type==="WINDOWS"){t.port=445;t.account="Administrator"}else{t.port=n.defaultPort;t.account="root"}}},{label:"登录IP",prop:"login_ip",type:"text",required:false,noRequiredMark:false,placeholder:window.i18n.t("请输入"),unique:true,errTag:true,rules:[{regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",content:window.i18n.t("IP不符合规范")},{trigger:"blur",content:window.i18n.t("冲突校验",{prop:"IP"}),validator:function e(t,i){if(!t)return true;var n=this.table.data.find((function(e){return e.id===i}));if(!n)return;return this.handleValidateUnique(n,{prop:"inner_ip"})}}]},{label:"BT传输加速",prop:"peer_exchange_switch_for_agent",type:"switcher",default:true,batch:true,required:false,noRequiredMark:false,width:115},{label:"传输限速",prop:"bt_speed_limit",type:"text",batch:true,required:false,noRequiredMark:false,appendSlot:"MB/s",iconOffset:40,width:115,rules:[{regx:"^[1-9]\\d*$",content:window.i18n.t("整数最小值校验提示",{min:1})}]},{label:"",prop:"",type:"operate",width:42}];t.tableManualConfig=r},487:function(e,t,i){"use strict";i.r(t);var n=i(565);var a=i(354);for(var r in a)if(["default"].indexOf(r)<0)(function(e){i.d(t,e,(function(){return a[e]}))})(r);var s=i(488);var o=i(2);var l=Object(o["a"])(a["default"],n["a"],n["b"],false,null,"7f9515ce",null);t["default"]=l.exports},488:function(e,t,i){"use strict";var n=i(356);var a=i.n(n);var r=a.a},489:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.editManualConfig=t.editConfig=void 0;var n=i(273);var a=[{label:"IP地址",prop:"inner_ip",type:"text",required:true,noRequiredMark:false,rules:[{regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",content:window.i18n.t("IP不符合规范")}],readonly:true},{label:"业务",prop:"bk_biz_id",type:"biz",required:true,multiple:false,noRequiredMark:false,readonly:true,placeholder:window.i18n.t("选择业务")},{label:"云区域",prop:"bk_cloud_id",type:"select",required:true,popoverMinWidth:160,noRequiredMark:false,placeholder:window.i18n.t("请选择"),getOptions:function e(){return this.cloudList.map((function(e){return{name:e.bk_cloud_name,id:e.bk_cloud_id}}))},getProxyStatus:function e(t){return t.proxyStatus},readonly:true},{label:"接入点",prop:"ap_id",type:"select",required:true,batch:true,default:-1,options:[],popoverMinWidth:160,noRequiredMark:false,placeholder:window.i18n.t("请选择"),getOptions:function e(){return this.apList}},{label:"操作系统",prop:"os_type",type:"select",required:true,batch:true,noRequiredMark:false,placeholder:window.i18n.t("请选择"),options:[{id:"WINDOWS",name:"Windows"},{id:"LINUX",name:"Linux"},{id:"AIX",name:"AIX"}],getReadonly:function e(t){return t.is_manual||/RELOAD_AGENT/gi.test(this.localMark)},handleValueChange:function e(t){if(t.os_type==="WINDOWS"){t.port=445;t.account="Administrator"}else{t.port=n.defaultPort;t.account="root"}}},{label:"登录端口",prop:"port",type:"text",required:true,batch:true,default:n.defaultPort,rules:[{regx:"^([0-9]|[1-9]\\d{1,3}|[1-5]\\d{4}|6[0-4]\\d{4}|65[0-4]\\d{2}|655[0-2]\\d|6553[0-5])$",content:window.i18n.t("端口范围",{range:"0-65535"})}],getReadonly:function e(t){return t&&t.os_type==="WINDOWS"}},{label:"登录账号",prop:"account",type:"text",required:true,batch:true,placeholder:window.i18n.t("请输入")},{label:"认证方式",prop:"auth_type",type:"select",required:true,batch:true,subTitle:window.i18n.t("密钥方式仅对Linux/AIX系统生效"),default:"PASSWORD",getOptions:function e(t){return t.os_type==="WINDOWS"?n.authentication.filter((function(e){return e.id!=="KEY"})):n.authentication},handleValueChange:function e(t){var i=n.authentication.find((function(e){return e.id===t.auth_type}))||{};t.prove=i.default||""}},{label:"密码密钥",prop:"prove",type:"password",required:false,show:true,batch:true,noRequiredMark:false,subTitle:window.i18n.t("仅对密码认证生效"),placeholder:window.i18n.t("请输入"),rules:[{content:window.i18n.t("认证信息过期"),validator:function e(t,i){var n=this.table.data.find((function(e){return e.id===i}));var a=typeof t==="undefined"||t===null||t==="";return!(a&&n&&!n.is_manual&&n.re_certification)}}],getReadonly:function e(t){return t.auth_type&&t.auth_type==="TJJ_PASSWORD"},getCurrentType:function e(t){var i=n.authentication.find((function(e){return e.id===t.auth_type}))||{};return i.type||"text"},getDefaultValue:function e(t){if(t.auth_type==="TJJ_PASSWORD"){return window.i18n.t("自动选择")}return""}},{label:"登录IP",prop:"login_ip",type:"text",required:false,noRequiredMark:false,placeholder:window.i18n.t("请输入"),rules:[{regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",content:window.i18n.t("IP不符合规范")}]},{label:"BT传输加速",prop:"peer_exchange_switch_for_agent",type:"switcher",default:true,batch:true,required:false,noRequiredMark:false,width:115},{label:"传输限速",prop:"bt_speed_limit",type:"text",batch:true,required:false,noRequiredMark:false,appendSlot:"MB/s",iconOffset:40,placeholder:window.i18n.t("请输入"),rules:[{regx:"^[1-9]\\d*$",content:window.i18n.t("整数最小值校验提示",{min:1})}]},{label:"",prop:"",type:"operate",width:35}];t.editConfig=a;var r=[{label:"IP地址",prop:"inner_ip",type:"text",required:true,noRequiredMark:false,rules:[{regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",content:window.i18n.t("IP不符合规范")}],readonly:true},{label:"业务",prop:"bk_biz_id",type:"biz",required:true,multiple:false,noRequiredMark:false,readonly:true},{label:"云区域",prop:"bk_cloud_id",type:"select",required:true,popoverMinWidth:160,noRequiredMark:false,placeholder:window.i18n.t("请选择"),getOptions:function e(){return this.cloudList.map((function(e){return{name:e.bk_cloud_name,id:e.bk_cloud_id}}))},getProxyStatus:function e(t){return t.proxyStatus},readonly:true},{label:"接入点",prop:"ap_id",type:"select",required:true,batch:true,default:-1,options:[],popoverMinWidth:160,noRequiredMark:false,placeholder:window.i18n.t("请选择"),getOptions:function e(){return this.apList}},{label:"操作系统",prop:"os_type",type:"select",required:true,batch:true,noRequiredMark:false,placeholder:window.i18n.t("请选择"),options:[{id:"WINDOWS",name:"Windows"},{id:"LINUX",name:"Linux"},{id:"AIX",name:"AIX"}],handleValueChange:function e(t){if(t.os_type==="WINDOWS"){t.port=445;t.account="Administrator"}else{t.port=n.defaultPort;t.account="root"}}},{label:"登录IP",prop:"login_ip",type:"text",required:false,noRequiredMark:false,placeholder:window.i18n.t("请输入"),rules:[{regx:"^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",content:window.i18n.t("IP不符合规范")}]},{label:"BT传输加速",prop:"peer_exchange_switch_for_agent",type:"switcher",default:true,batch:true,required:false,noRequiredMark:false,width:115},{label:"传输限速",prop:"bt_speed_limit",type:"text",batch:true,required:false,noRequiredMark:false,appendSlot:"MB/s",iconOffset:40,placeholder:window.i18n.t("请输入"),rules:[{regx:"^[1-9]\\d*$",content:window.i18n.t("整数最小值校验提示",{min:1})}]},{label:"",prop:"",type:"operate",width:35}];t.editManualConfig=r},490:function(e,t,i){"use strict";var n=i(357);var a=i.n(n);var r=a.a},559:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i.d(t,"b",(function(){return a}));var n=function(){var e=this;var t=e.$createElement;var i=e._self._c||t;return i("article",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading},expression:"{ isLoading: loading }"}],staticClass:"agent-setup"},[i("section",{ref:"setupContent",staticClass:"agent-setup-left"},[i("tips",{staticClass:"mb20",scopedSlots:e._u([{key:"default",fn:function(){return[i("ul",[!e.showSetupBtn?i("li",{staticClass:"tips-content-item"},[e._v(e._s(e.importTips))]):e._e(),e._v(" "),e.showSetupBtn?i("li",{staticClass:"tips-content-item"},[e._v("\n            "+e._s(e.$t("安装要求tips",{type:"Agent"}))+"\n            "),i("bk-link",{staticClass:"tips-link",attrs:{theme:"primary"},on:{click:e.handleShowPanel}},[e._v(e._s(e.$t("安装要求")))]),e._v("\n            "+e._s(e.$t("表格展示设置tips"))+"\n            "),i("bk-link",{staticClass:"tips-link",attrs:{theme:"primary"},on:{click:e.handleShowSetting}},[e._v(e._s(e.$t("表格展示设置")))])],1):e._e()])]},proxy:true}])}),e._v(" "),e.filterList.length&&e.showFilterTips?i("filter-ip-tips",{staticClass:"mb15",on:{click:e.handleShowDetail}}):e._e(),e._v(" "),e.showSetupBtn&&!e.isEdit?i("bk-form",{ref:"form",staticClass:"mb20 fs0 label-tl-form auto-width-form",attrs:{"label-width":0}},[i("install-method",{attrs:{"is-manual":e.isManual},on:{change:e.installMethodHandle}})],1):e._e(),e._v(" "),i("setup-table",{ref:"setupTable",attrs:{"local-mark":"agent_"+e.type,"setup-info":e.setupInfo,"is-manual":e.isManual,"min-items":e.minItems,height:e.scrollHeight,"need-plus":false,"virtual-scroll":e.virtualScroll,"extra-params":e.extraParams,"auto-sort":""},on:{delete:e.handleItemDelete},scopedSlots:e._u([{key:"empty",fn:function(){return[i("parser-excel",{on:{uploading:e.handleUploading},model:{value:e.importDialog,callback:function(t){e.importDialog=t},expression:"importDialog"}})]},proxy:true}])}),e._v(" "),i("div",{staticClass:"mt30 left-footer"},[!e.showSetupBtn?i("bk-button",{attrs:{theme:"primary","ext-cls":"nodeman-primary-btn mr10",disabled:e.disabledImport,loading:e.isUploading},on:{click:e.handleImport}},[e._v("\n        "+e._s(e.$t("导入"))+"\n      ")]):i("div",{staticClass:"btn-wrapper"},[i("bk-button",{attrs:{theme:"primary","ext-cls":"nodeman-primary-btn mr10",loading:e.loadingSetupBtn},on:{click:e.handleSetup}},[i("div",{staticClass:"install"},[i("span",[e._v(e._s(e.setupBtnText))]),e._v(" "),i("span",{staticClass:"num"},[e._v(e._s(e.setupNum))])])]),e._v(" "),!e.isEdit?i("bk-button",{staticClass:"nodeman-cancel-btn mr10",on:{click:e.handleLastStep}},[e._v("\n          "+e._s(e.$t("上一步"))+"\n        ")]):e._e()],1),e._v(" "),i("bk-button",{staticClass:"nodeman-cancel-btn",on:{click:e.handleCancel}},[e._v(e._s(e.$t("取消")))])],1)],1),e._v(" "),i("section",{staticClass:"agent-setup-right",class:{"right-panel":e.showRightPanel}},[i("right-panel",{attrs:{"host-type":e.hostType,"host-list":e.hostList},model:{value:e.showRightPanel,callback:function(t){e.showRightPanel=t},expression:"showRightPanel"}})],1),e._v(" "),[i("filter-dialog",{attrs:{list:e.filterList,title:e.$t("忽略详情")},model:{value:e.showFilterDialog,callback:function(t){e.showFilterDialog=t},expression:"showFilterDialog"}})]],2)};var a=[]},565:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i.d(t,"b",(function(){return a}));var n=function(){var e=this;var t=e.$createElement;var i=e._self._c||t;return i("div",{staticClass:"parser-excel"},[i("div",{staticClass:"parser-excel-file"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.status==="import",expression:"status === 'import'"}],staticClass:"file-wrapper",class:{hover:e.isHover},on:{mouseenter:e.handleMouseEnter,mouseleave:e.handleMouseLeave}},[i("i",{staticClass:"upload-icon nodeman-icon nc-upload-cloud"}),e._v(" "),i("i18n",{staticClass:"mt5",attrs:{path:"将文件拖到此处或"}},[i("span",{staticClass:"upload-btn"},[e._v(e._s(e.$t("点击上传")))])]),e._v(" "),i("input",{ref:"upload",staticClass:"file-input",attrs:{accept:e.accept,multiple:false,title:"",type:"file"},on:{change:e.handleFileChange}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.status==="parsing",expression:"status === 'parsing'"}],staticClass:"file-uploading",class:{error:e.file.status==="error",loading:e.isLoading},on:{mouseenter:e.handleMouseEnter,mouseleave:e.handleMouseLeave}},[i("i",{directives:[{name:"show",rawName:"v-show",value:e.showAbort&&e.isLoading,expression:"showAbort && isLoading"}],staticClass:"abort-icon nodeman-icon nc-delete",on:{click:e.handleAbortParse}}),e._v(" "),i("i",{staticClass:"uploading-icon nodeman-icon nc-excel"}),e._v(" "),i("div",{staticClass:"uploading-file ml10"},[i("div",{staticClass:"file-left"},[i("div",{staticClass:"file-info"},[i("span",[e._v(e._s(e.file.name))]),e._v(" "),e.file.status==="loading"?i("span",[e._v(e._s(e.file.progress+" %"))]):e._e()]),e._v(" "),i("div",{staticClass:"file-loading"},[e.file.status==="loading"?i("div",{staticClass:"progress"},[i("div",{staticClass:"progress-bar",style:{width:e.file.progress+"%"}})]):e.file.status==="success"?i("div",{staticClass:"parsing-success"},[i("i",{staticClass:"nodeman-icon nc-check-small"}),e._v("\n              "+e._s(e.$t("上传成功"))+"\n            ")]):e.file.status==="error"?i("div",{staticClass:"parsing-error"},[e._v("\n              "+e._s(e.file.msg)+"\n            ")]):e._e()])]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:["success","error"].includes(e.file.status),expression:"['success', 'error'].includes(file.status)"}],staticClass:"file-right"},[e.file.status==="success"?i("span",{staticClass:"file-size"},[e._v(e._s(e._f("fileSizeFormat")(e.file.size)))]):i("span",{staticClass:"error"},[i("i",{staticClass:"error-retry nodeman-icon nc-retry",on:{click:e.handleRetry}}),e._v(" "),i("i",{staticClass:"error-delete nodeman-icon nc-delete",on:{click:e.handleDelete}})])])])])]),e._v(" "),i("div",{staticClass:"parser-excel-tips"},[i("i18n",{attrs:{path:"仅支持xlsx格式的文件下载"}},[i("span",{staticClass:"tips-btn",on:{click:e.handleDownload}},[e._v(e._s(e.$t("模板文件")))])])],1)])};var a=[]}}]);