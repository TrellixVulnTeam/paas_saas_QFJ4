(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{268:function(t,e,a){"use strict";a.r(e);var n=a(542);var i=a(429);for(var r in i)if(["default"].indexOf(r)<0)(function(t){a.d(e,t,(function(){return i[t]}))})(r);var s=a(530);var o=a(2);var l=Object(o["a"])(i["default"],n["a"],n["b"],false,null,"6f361493",null);e["default"]=l.exports},429:function(t,e,a){"use strict";a.r(e);var n=a(430);var i=a.n(n);for(var r in n)if(["default"].indexOf(r)<0)(function(t){a.d(e,t,(function(){return n[t]}))})(r);e["default"]=i.a},430:function(t,e,a){"use strict";var n=a(1);Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;var i=n(a(8));var r=n(a(5));var s=n(a(6));var o=n(a(17));var l=n(a(279));var u=n(a(276));var c=n(a(278));var d=a(9);var f=a(10);function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);if(e)n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}));a.push.apply(a,n)}return a}function h(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};if(e%2){p(Object(a),true).forEach((function(e){(0,o.default)(t,e,a[e])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))}else{p(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}}return t}var b={name:"TaskHistory",mixins:[l.default,c.default],data:function t(){return{loading:false,titleStatusMap:{pending:this.$t("等待执行"),running:this.$t("正在执行"),success:this.$t("执行成功"),failed:this.$t("执行失败"),part_failed:this.$t("部分失败"),stop:this.$t("已终止"),terminated:this.$t("已终止")},pagination:{limit:50,current:1,count:0,limitList:[50,100,200]},tableList:[],search:{biz:[]},getHistortListDebounce:function t(){},filterData:[],sortData:{head:"",sort_type:""}}},computed:h({},(0,d.mapGetters)(["selectedBiz","fontSize"])),watch:{searchSelectValue:{handler:function t(){this.getHistortListDebounce()},deep:true}},created:function t(){this.search.biz=this.selectedBiz;this.getHistortList();this.handleGetConditionData()},mounted:function t(){this.getHistortListDebounce=(0,f.debounce)(300,this.pageChange)},methods:h(h({},(0,d.mapActions)("task",["requestHistoryTaskList","getFilterCondition"])),{},{handleGetConditionData:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){return r.default.wrap((function t(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return e.getFilterCondition();case 2:e.filterData=a.sent;case 3:case"end":return a.stop()}}}),t)})))()},getCommonParams:function t(){var e={page:this.pagination.current,pagesize:this.pagination.limit};if(this.search.biz.length){e.bk_biz_id=this.search.biz}if(this.sortData.head&&this.sortData.sort_type){e.sort=(0,i.default)({},this.sortData)}this.searchSelectValue.forEach((function(t){if(t.values){e[t.id]=t.values.map((function(t){return t.id}))}}));return e},getHistortList:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){var a,n;return r.default.wrap((function t(i){while(1){switch(i.prev=i.next){case 0:e.loading=true;e.runingQueue.splice(0,e.runingQueue.length);clearTimeout(e.timer);e.timer=null;a=e.getCommonParams();i.next=7;return e.requestHistoryTaskList(a);case 7:n=i.sent;e.pagination.count=n.total;e.tableList=n.list;e.runingQueue=n.list.filter((function(t){return t.status&&t.status!=="success"})).map((function(t){return t.id}));e.loading=false;case 12:case"end":return i.stop()}}}),t)})))()},handlePollData:function t(){var e=this;return(0,s.default)(r.default.mark((function t(){var a;return r.default.wrap((function t(n){while(1){switch(n.prev=n.next){case 0:n.next=2;return e.requestHistoryTaskList({page:1,pagesize:e.runingQueue.length,job_id:e.runingQueue});case 2:a=n.sent;a.list.forEach((function(t){var a=e.tableList.findIndex((function(e){return e.id===t.id}));if(a>-1){if(t.status!=="running"){var n=e.runingQueue.findIndex((function(e){return e===t.id}));e.runingQueue.splice(n,1)}e.$set(e.tableList,a,t)}}));case 4:case"end":return n.stop()}}}),t)})))()},handleBizChange:function t(){this.getHistortListDebounce()},pageChange:function t(e){this.pagination.current=e||1;this.getHistortList()},paginationChange:function t(e){this.pagination.limit=e||10;this.getHistortListDebounce()},detailHandler:function t(e,a){this.$router.push({name:"taskDetail",params:{taskId:e.id,status:a&&typeof a==="string"?a.toUpperCase():""}})},isEmptyCell:function t(e){return!(0,f.isEmpty)(e)},getRowStyle:function t(){return{cursor:"pointer"}},sortHandle:function t(e){var a=e.prop,n=e.order;(0,i.default)(this.sortData,{head:a,sort_type:n==="ascending"?"ASC":"DEC"});this.getHistortListDebounce()},renderHeader:function t(){var e=this.$createElement;return e(u.default)},takesTimeFormat:function t(e){return(0,f.takesTimeFormat)(e)}})};e.default=b},431:function(t,e,a){},530:function(t,e,a){"use strict";var n=a(431);var i=a.n(n);var r=i.a},542:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a.d(e,"b",(function(){return i}));var n=function(){var t=this;var e=t.$createElement;var a=t._self._c||e;return a("div",{staticClass:"task-history-wrapper"},[[a("bk-biz-select",{attrs:{"ext-cls":"left-select",placeholder:t.$t("全部业务")},on:{change:t.handleBizChange},model:{value:t.search.biz,callback:function(e){t.$set(t.search,"biz",e)},expression:"search.biz"}}),t._v(" "),a("bk-search-select",{staticClass:"task-filter-select",attrs:{"show-condition":false,placeholder:t.$t("请输入"),data:t.searchSelectData},on:{change:t.handleSearchSelectChange},model:{value:t.searchSelectValue,callback:function(e){t.searchSelectValue=e},expression:"searchSelectValue"}}),t._v(" "),a("section",{staticClass:"task-table"},[a("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading},expression:"{ isLoading: loading }"}],ref:"agentTable",class:"head-customize-table "+t.fontSize,attrs:{data:t.tableList,pagination:t.pagination,"limit-list":t.pagination.limitList,"row-style":t.getRowStyle},on:{"sort-change":t.sortHandle,"row-click":t.detailHandler,"page-change":t.pageChange,"page-limit-change":t.paginationChange}},[a("bk-table-column",{attrs:{label:t.$t("任务ID"),prop:"job_id",resizable:false},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("a",{staticClass:"primary",attrs:{href:"javascript: "}},[t._v(t._s(n.id))])]}}])}),t._v(" "),a("bk-table-column",{attrs:{"class-name":"biz-column",prop:"bkBizScopeDisplay",label:t.$t("业务"),resizable:false},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n            "+t._s(a.bkBizScopeDisplay&&a.bkBizScopeDisplay.length?a.bkBizScopeDisplay.join(","):"--")+"\n          ")]}}])}),t._v(" "),a("bk-table-column",{attrs:{prop:"job_type","min-width":"140",label:t.$t("任务类型"),"render-header":t.renderFilterHeader},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n            "+t._s(a.jobTypeDisplay?a.jobTypeDisplay:"--")+"\n          ")]}}])}),t._v(" "),a("bk-table-column",{attrs:{prop:"created_by",label:t.$t("执行者"),"render-header":t.renderFilterHeader},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n            "+t._s(a.createdBy?a.createdBy:"--")+"\n          ")]}}])}),t._v(" "),a("bk-table-column",{attrs:{width:"185",label:t.$t("执行时间"),prop:"startTime"}}),t._v(" "),a("bk-table-column",{attrs:{align:"right",label:t.$t("总耗时"),prop:"costTime"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.takesTimeFormat(a.costTime))+" ")]}}])}),t._v(" "),a("bk-table-column",{attrs:{"min-width":"20",resizable:false}}),t._v(" "),a("bk-table-column",{attrs:{prop:"status","min-width":"115",label:t.$t("执行状态"),resizable:false,"render-header":t.renderFilterHeader},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("div",{staticClass:"col-execution"},[n.status==="running"?a("loading-icon"):a("span",{class:"execut-mark execut-"+n.status}),t._v(" "),a("span",{attrs:{title:t.titleStatusMap[n.status]}},[t._v(t._s(t.titleStatusMap[n.status]))])],1)]}}])}),t._v(" "),a("bk-table-column",{attrs:{align:"right",label:t.$t("总数"),resizable:false,prop:"total_count",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t.isEmptyCell(n.statistics.totalCount)?a("span",[t._v(t._s(n.statistics.totalCount))]):a("span",[t._v("--")])]}}])}),t._v(" "),a("bk-table-column",{attrs:{align:"right",label:t.$t("成功数"),prop:"success_count",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t.isEmptyCell(n.statistics.successCount)?a("a",{staticClass:"success",attrs:{href:"javascript: "},on:{click:function(e){e.stopPropagation();return t.detailHandler(n,"success")}}},[t._v("\n              "+t._s(n.statistics.successCount)+"\n            ")]):a("span",[t._v("--")])]}}])}),t._v(" "),a("bk-table-column",{attrs:{"min-width":"80",align:"right",label:t.$t("失败数"),prop:"failed_count",sortable:"custom",resizable:false},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t.isEmptyCell(n.statistics.failedCount)?a("a",{staticClass:"failed",attrs:{href:"javascript: "},on:{click:function(e){e.stopPropagation();return t.detailHandler(n,"failed")}}},[t._v("\n              "+t._s(n.statistics.failedCount)+"\n            ")]):a("span",[t._v("--")])]}}])}),t._v(" "),a("bk-table-column",{key:"setting",attrs:{prop:"colspaSetting",width:"42","render-header":t.renderHeader,resizable:false}})],1)],1)]],2)};var i=[]}}]);