(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{255:function(e,t,n){"use strict";n.r(t);var r=n(558);var s=n(358);for(var a in s)if(["default"].indexOf(a)<0)(function(e){n.d(t,e,(function(){return s[e]}))})(a);var i=n(491);var l=n(2);var o=Object(l["a"])(s["default"],r["a"],r["b"],false,null,"52ac4c5e",null);t["default"]=o.exports},358:function(e,t,n){"use strict";n.r(t);var r=n(359);var s=n.n(r);for(var a in r)if(["default"].indexOf(a)<0)(function(e){n.d(t,e,(function(){return r[e]}))})(a);t["default"]=s.a},359:function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var s=r(n(275));var a=r(n(5));var i=r(n(6));var l=r(n(17));var o=n(9);var c=r(n(272));var u=n(279);var d=n(280);var f=n(10);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);if(t)r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};if(t%2){p(Object(n),true).forEach((function(t){(0,l.default)(e,t,n[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(n))}else{p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}}return e}var h={name:"AutoDiscovery",components:{Tips:c.default},mixins:[u.mixins],data:function e(){return{loading:true,tipsList:this.$t("自动发现topTip"),listenResize:null,isScroll:false,filterType:"pending",filterData:[{name:this.$t("IP地址"),type:"ip",id:"1"},{name:this.$t("操作系统"),type:"sys",id:"2",multiable:true,children:[{id:"windows",name:"Windows",checked:false},{id:"linux",name:"Linux",checked:false}]},{name:this.$t("Agent状态"),type:"status",id:"3",multiable:true,children:[{id:"normal",name:this.$t("正常"),checked:false},{id:"error",name:this.$t("异常"),checked:false}]},{name:this.$t("Agent版本"),type:"version",id:"4",multiable:true,children:[{id:"1.6.3",name:"1.6.3",checked:false}]}],selectTable:[],selected:[],tableAllList:[],operationMap:{ignore:this.$t("是否忽略此IP"),ignoreMup:this.$t("是否忽略选中的IP"),enter:this.$t("是否录入此IP"),enterMup:this.$t("是否录入选中的IP"),restore:this.$t("是否恢复此IP"),restoreMup:this.$t("是否恢复选中的IP")},statusMap:{normal:{name:this.$t("正常"),status:"normal"},error:{name:this.$t("异常"),status:"error"},unknown:{name:this.$t("未知"),status:"unknown"}}}},computed:{tableList:function e(){var t=this;return this.tableAllList.filter((function(e){return e.type===t.filterType}))}},mounted:function e(){var t=this;this.requesTableList();this.listenResize=(0,f.debounce)(300,(function(e){return t.handleResize(e)}));(0,d.addListener)(this.$el,this.listenResize)},beforeDestroy:function e(){(0,d.removeListener)(this.$el,this.listenResize)},methods:b(b({},(0,o.mapActions)("discovery",["requestDiscoveryList","setHostIdleStatus"])),{},{handleResize:function e(){this.isScroll=this.$el.scrollHeight+60>this.$root.$el.clientHeight-52},handleCommit:function e(t,n){var r=this;return(0,i.default)(a.default.mark((function e(){var s,i,l;return a.default.wrap((function e(a){while(1){switch(a.prev=a.next){case 0:r.loading=true;s=t.includes("Mup")?r.selectTable:[n];i={type:t,data:s};a.next=5;return r.$store.dispatch("discovery/setHostIdleStatus",i);case 5:l=a.sent;if(t.includes("ignore")||t.includes("restore")){r.tableAllList.forEach((function(e){if(s.find((function(t){return t.id===e.id}))){e.type=t.includes("ignore")?"ignored":"pending"}}))}if(t.includes("enter")){r.tableAllList=r.tableAllList.filter((function(e){return!s.find((function(t){return e.id===t.id}))}))}r.$refs.discoveryTable.clearSelection();if(l.message){r.$bkMessage({theme:"success",message:l.message})}r.loading=false;case 11:case"end":return a.stop()}}}),e)})))()},requesTableList:function e(){var t=this;return(0,i.default)(a.default.mark((function e(){var n;var r;return a.default.wrap((function e(a){while(1){switch(a.prev=a.next){case 0:t.loading=true;a.next=3;return t.requestDiscoveryList();case 3:r=a.sent;(n=t.tableAllList).splice.apply(n,[0,t.tableAllList.length].concat((0,s.default)(r.data)));t.loading=false;case 6:case"end":return a.stop()}}}),e)})))()},handleTypeChange:function e(){this.filterType=this.filterType==="pending"?"ignored":"pending";this.selected.splice(0,this.selected.length);this.clearTableSelect()},handleTableSelect:function e(t){var n;(n=this.selectTable).splice.apply(n,[0,this.selectTable.length].concat((0,s.default)(t)))},getRowStyle:function e(){return this.filterType==="pending"?{}:{color:"#979BA5"}}})};t.default=h},360:function(e,t,n){},491:function(e,t,n){"use strict";var r=n(360);var s=n.n(r);var a=s.a},558:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n.d(t,"b",(function(){return s}));var r=function(){var e=this;var t=e.$createElement;var n=e._self._c||t;return n("section",{class:["auto-discovery-wrapper",{"footer-fixed":e.isScroll&&e.tableList.length}]},[n("Tips",{staticClass:"mb20",attrs:{list:e.tipsList}}),e._v(" "),n("div",{staticClass:"filter clearfix"},[n("div",{staticClass:"bk-button-group fl"},[n("bk-button",{class:["minw100",{"is-selected":e.filterType==="pending"}],on:{click:e.handleTypeChange}},[e._v(e._s(e.$t("待处理")))]),e._v(" "),n("bk-button",{class:["minw100",{"is-selected":e.filterType==="ignored"}],on:{click:e.handleTypeChange}},[e._v(e._s(e.$t("已忽略")))])],1),e._v(" "),n("bk-search-select",{staticClass:"discovery-filter-select",attrs:{filter:"",placeholder:e.$t("请选择条件搜索"),data:e.filterData},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1),e._v(" "),n("section",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading},expression:"{ isLoading: loading }"}],staticClass:"discovery-table-wrapper"},[n("bk-table",{ref:"discoveryTable",attrs:{data:e.tableList,"row-key":"id",size:"small","row-style":e.getRowStyle},on:{select:e.handleTableSelect,"select-all":e.handleTableSelect}},[n("bk-table-column",{attrs:{type:"selection",width:"60",align:"center"}}),e._v(" "),n("bk-table-column",{attrs:{label:"IP",prop:"ip",resizable:false}}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("云区域_ID"),resizable:false},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                    "+e._s(n.cloudName+" ("+n.cloudId+")")+"\n                ")]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("操作系统"),prop:"sys",resizable:false,"render-header":e.renderFilterHeader}}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("Agent状态"),prop:"status",resizable:false,"render-header":e.renderFilterHeader},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e.statusMap[r.status]?n("div",{staticClass:"col-status"},[n("span",{class:"status-"+r.status}),e._v(" "),n("span",[e._v(e._s(e.statusMap[r.status].name))])]):e._e()]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("Agent版本"),prop:"version",resizable:false,"render-header":e.renderFilterHeader}}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("发现时间"),prop:"find_time",resizable:false}}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("操作"),resizable:false,width:180},scopedSlots:e._u([e.filterType==="pending"?{key:"default",fn:function(t){var r=t.row;return[n("bk-button",{attrs:{theme:"primary",text:"","ext-cls":"col-operate-btn"},on:{click:function(t){t.stopPropagation();return e.handleCommit("enter",r)}}},[e._v(e._s(e.$t("确认录入")))]),e._v(" "),n("bk-button",{attrs:{theme:"primary",text:"","ext-cls":"col-operate-btn"},on:{click:function(t){t.stopPropagation();return e.handleCommit("ignore",r)}}},[e._v(e._s(e.$t("忽略")))])]}}:{key:"default",fn:function(t){var r=t.row;return[n("bk-button",{attrs:{theme:"primary",text:"","ext-cls":"col-operate-btn"},on:{click:function(t){t.stopPropagation();return e.handleCommit("restore",r)}}},[e._v(e._s(e.$t("恢复")))])]}}],null,true)})],1),e._v(" "),e.tableList.length?n("section",{staticClass:"auto-discovery-footer"},[e.filterType==="pending"?[n("bk-button",{staticClass:"nodeman-primary-btn",attrs:{disabled:!e.selectTable.length,theme:"primary"},on:{click:function(t){t.stopPropagation();return e.handleCommit("enterMup")}}},[e._v(e._s(e.$t("确认录入")))]),e._v(" "),n("bk-button",{staticClass:"minw80",attrs:{disabled:!e.selectTable.length},on:{click:function(t){t.stopPropagation();return e.handleCommit("ignoreMup")}}},[e._v(e._s(e.$t("忽略")))])]:[n("bk-button",{staticClass:"nodeman-primary-btn",attrs:{theme:"primary",disabled:!e.selectTable.length},on:{click:function(t){t.stopPropagation();return e.handleCommit("restoreMup")}}},[e._v(e._s(e.$t("恢复")))])]],2):e._e()],1)],1)};var s=[]}}]);